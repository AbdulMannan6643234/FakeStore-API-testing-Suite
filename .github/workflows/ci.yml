name: CI + TestNG

on:
  push:
  branches: ['main']
  pull_request: 
  branches: ['main']
jobs:
run-tests:
  runs-on: ubuntu-latest
  steps:
  - name: checkout-repo
    uses: actions/checkout@v4
  - name: initialise java
    uses: actions/setup-java@v4 
    with:
      java-version: '17'
      distribution: 'temurin'
  - name: Cache Maven Dependencies
    uses: actions/cache@v4
    with:
      path: ~/.m2
      key: ${{ runner.os }}-maven-${{hashfiles('**/pom.xml')}}
      restore-keys: |
            ${{ runner.os }}-maven-
  - name: run TestNG tests
    uses: mvn clean test -Dgroups="smoke,regression"

  - name: Upload reports
    if: always()
    uses: actions/upload-artifact@v4
    with:
      name: TestNG-Reports
      path: target/surefire-reports/